{% extends "layout.jinja" %}

{% block container %}

      <h1>Tower Details</h1>

      <div id="tower_info">

        <table class="table table-bordered table-condensed">
          <thead>
            <tr>
              <th>Key</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>

      </div>

{% endblock %}

{% block script %}

    $(document).ready(function() {
        var host = '{{ g.json_root }}';

        $.get(host + '/tower/{{ g.tower_id }}', function(data) {
            if (data.error) {
                // XXX proper error messaging
                populateTable([data.error]);
                return null;
            }

            var tower = data.tower;
            var tower_values = [
                ['Celestial', tower.celestialName],
                ['Region', tower.regionName],
                ['Tower Type', tower.typeName],
                ['Online Since', tower.onlineSinceFormatted],
                ['Offline At', tower.offlineAtFormatted],
                ['State', tower.stateName],
                ['Reinforcement', tower.reinforcementLengthFormatted]
            ]

            populateTower(tower_values)
        });
    });

    function populateTower(values) {
        $('#tower_info').TidyTable({
            enableCheckbox : false,
            enableMenu     : false,
            tableClass     : "table table-bordered table-condensed"
        },
        {
            columnTitles : ['Key', 'Value'],
            columnValues : values,

            // do something with selected rows
            menuOptions : [
                ['Option 1', { callback : doSomething1 }],
                ['Option 2', { callback : doSomething2 }]
            ]
        }, doSomething3);
    }

    // do something with selected results
    function doSomething1(rows) {
        alert('callback1(rows=' + rows.length + "')");
    }

    function doSomething2(rows) {
        alert('callback2(rows=' + rows.length + "')");
    }

    function doSomething3(name, value) {
        alert("callback(name='" + name + "', value='" + value + "')");
    }

{% endblock %}
