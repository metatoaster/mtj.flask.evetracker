{% extends "layout.jinja" %}

{% block container %}

      <div id="users">

        <div id="user_overview">

        <table class="table table-bordered table-condensed">
          <thead>
            <tr>
              <th>Login</th>
              <th>Name</th>
              <th>Email</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>

          {% for user in users %}
            <tr>
              <td>{{ user.login }}</td>
              <td>{{ user.name }}</td>
              <td>{{ user.email }}</td>
              <td><a href="edit/{{ user.login }}">Edit</a></td>
            </tr>
          {% endfor %}

          </tbody>
        </table>

        </div>
      </div>

{% endblock %}

{% block script %}

    $(document).ready(function() {
        var data = extractTable('#user_overview');
        $('#user_overview').TidyTable({
            tableClass     : "table table-bordered table-condensed"
        },
        {
            columnTitles : data['thead'],
            columnValues : data['tbody'],
        });
    });

    function extractTable(selector) {
        var thead = [];
        var tbody = [];
        var tbl = $(selector).find('table:first');

        var m = tbl.find('thead tr:first th');
        m.each(function(i) {
            thead.push($(m[i]).html());
        });

        var m = tbl.find('tbody tr')
        m.each(function(i) {
            var row = [];
            var n = $(m[i]).find('td');
            n.each(function(j) {
                row.push({
                    'col_value': $(n[j]).html(),
                    'value': $(n[j]).text()
                });
            });
            tbody.push(row);
        })

        return {
            'thead': thead,
            'tbody': tbody
        };
    }

{% endblock %}
